<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Scraper Legible</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      background: #f5f5f5;
      padding: 40px;
    }

    .box {
      background: white;
      padding: 30px;
      border-radius: 14px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    input {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 15px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background: #111827;
      color: white;
      cursor: pointer;
    }

    h2 {
      margin-top: 0;
    }

    .result-block {
      margin-top: 35px;
      padding: 25px;
      background: #fafafa;
      border-left: 5px solid #111827;
      border-radius: 8px;
    }

    .result-block h3 {
      margin-top: 0;
      color: #111827;
    }

    .loading {
      margin-top: 20px;
      text-align: center;
      font-style: italic;
      color: #666;
    }
  </style>
</head>

<body>
  <div class="box">
    <h2>Scraper (Versión legible)</h2>
    <p>Pega una URL para scrapear:</p>

    <input id="inputUrl" type="text" placeholder="https://ejemplo.com" />

    <button onclick="scrape()">Scrapear</button>

    <div id="output" class="loading">Esperando URL...</div>
  </div>

  <script>
    async function scrape() {
      const url = document.getElementById("inputUrl").value.trim();
      if (!url) {
        alert("Escribe una URL primero.");
        return;
      }

      const output = document.getElementById("output");
      output.innerHTML = "<div class='loading'>Cargando contenido...</div>";

      try {
        // Cambia este endpoint a tu API correcta:
        const endpoint = "https://scraper-json.vercel.app/api/crawl?limit=5&start=" + encodeURIComponent(url);

        const res = await fetch(endpoint);
        const json = await res.json();

        if (!json.results || json.results.length === 0) {
          output.innerHTML = "<p>No se encontró texto utilizable en esta página.</p>";
          return;
        }

        // Construir bloques legibles
        let html = "";
        json.results.forEach(page => {
          const text = page.text
            .replace(/\\n/g, "\n")
            .replace(/\n{3,}/g, "\n\n")
            .split("\n\n")
            .map(p => `<p>${p.trim()}</p>`)
            .join("");

          html += `
            <div class="result-block">
              <h3>${page.title}</h3>
              ${text}
              <small style="color:#666;">URL: ${page.url}</small>
            </div>
          `;
        });

        output.innerHTML = html;

      } catch (err) {
        output.innerHTML = "<p>Error: " + err.message + "</p>";
      }
    }
  </script>
</body>
</html>
